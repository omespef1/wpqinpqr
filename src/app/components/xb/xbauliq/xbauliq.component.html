<ngx-spinner bdColor="rgba(51,51,51,0.3)" size="large">
    <!-- <p text-center style="font-size: 15px; color: gray">{{loading}}</p> -->
</ngx-spinner>
<div class="jumbotron jumbotron">
    <div class="container-fluid">
        <h1 class="display-4">Generación de autoliquidación</h1>

    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-lg-4 col-md-1 col-sm-1">
            <img src="data:image/jpeg;base64,{{logo}}" class="img-fluid" alt="Responsive image">
        </div>
    </div>

    <div class="card card-gray">
        <div class="card-header bg-primary text-white">Parámetros</div>
        <div class="card-body">
            <form #xbauliq="ngForm">
                <div class="row">
                    <div class="alert alert-info" role="alert">
                        * Mediante esta opción podrá generar la autoliquidación correspondiente a las cuentas por pagar
                        a la SuperIntendencia de Vigilancia y Seguridad Privada, para cada uno de los conceptos
                        pendientes y por cada una de las vigencias. Para ello, debe pulsar
                        sobre el botón "CONSULTAR Y/O LIQUIDAR". * Las cuentas e intereses se presentan con corte a la
                        fecha en la que se realiza la consulta. * Solo se presentan las cuentas que tienen saldos
                        pendientes de pago.
                    </div>
                </div>
                <div class="row">
                    <div class="alert alert-danger">
                        <p> Si tiene informes financieros por reportar, esta autoliquidación no desplegará información
                            asociada con ello.
                            Verifique si ha presentado toda la información financiera que le ha sido requerida. En caso
                            de tener reportes pendientes, por favor repórtelos.
                            Los valores indicados solamente aplican para para la fecha de generación de la
                            autoliquidación: {{par_fech | date:'dd/MM/yyyy'}}. Si no realiza el pago en esta fecha por
                            favor genere nuevamente la autoliquidación
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-2 col-md-3 col-xs-12 col-sm-12">
                        <label for="pro_codi">Nit</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text">
                                    <span> <span><i class="fas fa-id-card"></i></span></span>
                                </div>
                            </div>
                            <input type="text" [(ngModel)]="client" name="cli_coda" readonly=true class="form-control"
                                placeholder="Nit">
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3 col-xs-12 col-sm-12">
                        <label for="pro_codi">Nombre Entidad</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text">
                                    <span> <span><i class="fas fa-id-card"></i></span></span>
                                </div>
                            </div>
                            <input type="text" name="ter_noco" readonly=true class="form-control" [(ngModel)]="ter_noco"
                                placeholder="Nombre de entidad">
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-xs-12 col-sm-12">
                        <label for="pro_codi">Fecha de pago</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text">
                                    <span><i class="fas fa-calendar-alt"></i></span>
                                </div>
                            </div>
                            <input matInput placeholder="Fecha de pago" [min]="today" [matDatepicker]="fec_pago"
                                type="text" class="form-control" name="fec_pago" id="fec_pago" [(ngModel)]="par_fech"
                                required #fec_pago="ngModel" readonly>
                            <mat-datepicker-toggle [for]="fec_pago"></mat-datepicker-toggle>
                            <mat-datepicker disabled="false" #fec_pago touchUi></mat-datepicker>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-xs-12 col-sm-12">
                        <br>
                        <button [disabled]="loading" type="button" class="btn btn-success btn-block"
                            (click)="GetAutliq()">
                            <i [class]="!loading?'fa fa-search':'fa fa-cog fa-spin'">
                            </i> {{ loading?'Consultando...':'Consultar y/o Liquidar' }}
                        </button>
                    </div>
                    <div class="col-lg-1 col-md-3 col-xs-12 col-sm-12">
                        <br>
                        <button type="button" class="btn btn-danger">
                            <i class="fa fa-trash">
                            </i> Limpiar
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="card card-gray" *ngIf="cacxcob.length>0">
        <div class="card-header bg-primary text-white">Autoliquidación</div>
        <div class="card-body">

            <div class="row">
                <table class="table table-striped table-hover table-bordered">
                    <thead class="thead-light table-info text-center">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Tipo Servicio</th>
                            <th scope="col">Vigencia</th>
                            <th scope="col">Concepto</th>
                            <th scope="col">Descripción</th>
                            <th scope="col">Base Gravable</th>
                            <th scope="col">Tarifa</th>
                            <th scope="col">Valor Inicial</th>
                            <th scope="col">Saldo</th>
                            <th scope="col">Intereses anteriores</th>
                            <th scope="col">Intereses Mora</th>
                            <th scope="col">Total a Pagar</th>
                            <th scope="col">Error Consultando</th>
                            <th scope="col">Liquidar</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of cacxcob | paginate: { itemsPerPage: 10, currentPage: p };let i = index">
                            <td scope="row">
                                {{ i }}
                            </td>
                            <td>
                                {{ item.cts_nomb  }}
                            </td>
                            <td>
                                {{ item.ddi_vige }}
                            </td>
                            <td>
                                {{ item.top_nomb | titlecase }}
                            </td>
                            <td>
                                {{ item.cxc_desc }}
                            </td>
                            <td>
                                {{ item.cxc_cont==0? 'No aplica' :  item.cxc_cont  }}
                            </td>
                            <td>
                                {{ item.cxc_cont==0? 'No aplica' :  item.dpa_tari  }}
                            </td>
                            <td>
                                {{ item.cxc_tota | currency:'COP' }}
                            </td>
                            <td>
                                {{ item.cxc_sald  | currency:'COP'}}
                            </td>
                            <td>
                                {{ item.cxc_inan | currency:'COP' }}
                            </td>
                            <td>
                                {{ item.cxc_inmo | currency:'COP' }}
                            </td>
                            <td>
                                {{ item.cxc_sald + item.cxc_inmo + item.cxc_inan | currency:'COP' }}
                            </td>
                            <td class="table-td-error">
                                {{item.error}}
                            </td>
                            <td>
                                <span class="switch">
                                    <input type="checkbox" [name]="'chkLiquida' + i.toString()" [(ngModel)]="item.liq_apro"
                                        class="switch" [id]="'switch-id' + i.toString()">
                                    <label [for]="'switch-id' + i.toString()"></label>
                                </span>
                            </td>
                        </tr>

                    </tbody>
                    <!-- <pagination-controls  id="some_id"
                        (pageChange)="pageChanged(p =$event)"
                        maxSize="10"
                        directionLinks="true"
                        autoHide="true"
                        responsive="true"
                        previousLabel="Anterior"
                        nextLabel="Siguiente"
                        screenReaderPaginationLabel="Paginación"
                        screenReaderPageLabel="page"
                        screenReaderCurrentLabel="Página actual">
  </pagination-controls> -->
                </table>

                <pagination-controls (pageChange)="p = $event" maxSize="10" autoHide="true" previousLabel="Anterior"
                    nextLabel="Siguiente">

                </pagination-controls>


            </div>
            <div class="row">
                 <div class="col-sm-12 col-xs-12 col-md-6 col-lg-4 text-right">
                        <table class="table table-striped table-hover table-bordered">
                                <tbody class="thead-light table-primary text-center">
                                    <tr>
                                        <th scol="col">
                                            Total Contribución e intereses
                                        </th>
                                        <td>
                                            {{ GetTotalContribucion() | currency:'COP'}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scol="col">
                                            Total multas y sanciones
                                        </th>
                                        <td>
                                            {{ GetTotalMultas() | currency:'COP'}}
                                        </td>
                                    </tr>
            
                                    <tr>
                                        <th scol="col">
                                            Total a pagar
                                        </th>
                                        <td>
                                            {{ GetTotalContribucion()  +  GetTotalMultas() |currency:'COP'}}
                                        </td>
                                    </tr>
            
            
            
                                </tbody>
            
                            </table>
                 </div>
                 <div class="col-sm-12 col-xs-12 col-md-6 col-lg-1">
                     <button [disabled]="CuentasXaprobar() || loading" type="button" (click)="SetXbAutliq()" data-toggle="tooltip" data-placement="top" title="Tooltip on top" class="btn btn-success btn-lg">
                            <i class="fa fa-check">
                                </i> Aprobar
                     </button>
                 </div>
               

            </div>






        </div>

    </div>


</div>

<app-gnempre title="Seleccione empresa" (accept)="_EmpreModal.dismiss();GetXbPceca();">
    <form>
        <div class="form-group">
            <label for="emp_codi" class="col-form-label"></label>
            <select class="form-control" id="usu_codi" name="usu_codi" [(ngModel)]="emp_codi" required
                #usu_codi="ngModel">
                <option value="0">Seleccione</option>
                <option *ngFor="let companie of companies" [value]="companie.emp_codi">{{companie.emp_nomb | titlecase}}
                </option>
            </select>
        </div>
    </form>
</app-gnempre>